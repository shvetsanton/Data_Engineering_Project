{"paragraphs":[{"text":"%pyspark\n# Make sure psycopg2 is installed:\nimport psycopg2","dateUpdated":"2017-05-09T19:41:29+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1494358819689_-1739506063","id":"20170407-013059_453085699","dateCreated":"2017-05-09T19:40:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:267","user":"anonymous","dateFinished":"2017-05-09T19:42:02+0000","dateStarted":"2017-05-09T19:41:29+0000"},{"text":"%pyspark\n# Load data from S3\nraw_weather = sc.textFile(\"s3a://weatherstream2/*\").cache()","dateUpdated":"2017-05-09T20:02:03+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1494358819693_-1741045059","id":"20170407-004016_730184283","dateCreated":"2017-05-09T19:40:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:268","user":"anonymous","dateFinished":"2017-05-09T20:02:14+0000","dateStarted":"2017-05-09T20:02:03+0000"},{"text":"%pyspark\n\ndef current_data(city, raw_current):\n    city = ''.join(city.split())\n    time = raw_current['time']\n    temperature = raw_current['temperature']\n    precipProbability = raw_current['precipProbability']\n    precipIntensity = raw_current['precipIntensity']\n    pressure = raw_current['pressure']\n    humidity = raw_current['humidity']\n    visibility = raw_current['visibility']\n    ozone = raw_current['ozone']\n    cloudCover = raw_current['cloudCover']\n    dewPoint = raw_current['dewPoint']\n\n    return [city, time, temperature, precipProbability, precipIntensity, pressure, humidity,\n            visibility, ozone, cloudCover, dewPoint]","dateUpdated":"2017-05-09T19:42:07+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1494358819694_-1739890812","id":"20170421-173923_1097134295","dateCreated":"2017-05-09T19:40:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:269","user":"anonymous","dateFinished":"2017-05-09T19:42:07+0000","dateStarted":"2017-05-09T19:42:07+0000"},{"text":"%pyspark\n\ndef split_data(raw):\n    test = []\n    for key in raw.keys():\n        test.append(current_data(key, raw[key]))\n    return test","dateUpdated":"2017-05-09T19:42:10+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1494358819694_-1739890812","id":"20170421-173516_440573270","dateCreated":"2017-05-09T19:40:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:270","user":"anonymous","dateFinished":"2017-05-09T19:42:10+0000","dateStarted":"2017-05-09T19:42:10+0000"},{"text":"%pyspark\nfrom functools import partial\nfrom demjson import decode\nfrom psycopg2 import IntegrityError, InternalError\n\ndef insert(rows):\n    total_count = 0\n    if rows:\n        import psycopg2\n        conn = psycopg2.connect(**{'dbname': 'postgres',\n                                 'host': 'postgresql-project.cj7ztqpujxwz.us-east-1.rds.amazonaws.com',\n                                 'password': 'Kharkov62',\n                                 'user': 'ashvets'})\n        cur = conn.cursor()\n        for datum in rows:\n            datum = decode(datum)\n            split_datum = split_data(datum)\n            for row in split_datum:\n                total_count += 1\n            \n                try:\n                    cur.execute(\"INSERT INTO weather VALUES (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s)\",\n                                 (row))\n                    conn.commit()\n                except (IntegrityError, InternalError) as e:  # prevents duplicates\n                    cur.execute(\"rollback\")\n                    print('current # {}: {}'.format(total_count, row))\n\n","dateUpdated":"2017-05-09T20:31:06+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1494358819695_-1740275561","id":"20170509-181305_1231639201","dateCreated":"2017-05-09T19:40:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:271","user":"anonymous","dateFinished":"2017-05-09T20:31:06+0000","dateStarted":"2017-05-09T20:31:06+0000"},{"text":"%pyspark\nraw_weather.foreachPartition(insert)","dateUpdated":"2017-05-09T20:31:08+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1494358819695_-1740275561","id":"20170509-181919_633345637","dateCreated":"2017-05-09T19:40:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:272","user":"anonymous","dateFinished":"2017-05-09T20:31:25+0000","dateStarted":"2017-05-09T20:31:08+0000"},{"text":"%pyspark\nraw_weather.take(1)","dateUpdated":"2017-05-09T19:47:48+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1494358819700_-1731426336","id":"20170407-004219_1197942124","dateCreated":"2017-05-09T19:40:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:277","user":"anonymous","dateFinished":"2017-05-09T19:47:48+0000","dateStarted":"2017-05-09T19:47:48+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[u\"{'Santa Barbara': {'pressure': 1016.28, 'nearestStormDistance': 23, 'precipProbability': 0, 'humidity': 0.58, 'dewPoint': 43.5, 'icon': 'clear-night', 'temperature': 58.13, 'precipIntensity': 0, 'visibility': 10, 'time': 1492137820, 'nearestStormBearing': 19, 'ozone': 314.84, 'cloudCover': 0.04, 'windSpeed': 12.89, 'windBearing': 311, 'summary': 'Clear', 'apparentTemperature': 58.13}, 'Walnut Creek': {'pressure': 1020.25, 'nearestStormDistance': 3, 'precipProbability': 0, 'humidity': 0.61, 'dewPoint': 39.1, 'icon': 'clear-night', 'temperature': 52.2, 'precipIntensity': 0, 'visibility': 10, 'time': 1492137820, 'nearestStormBearing': 316, 'ozone': 346.29, 'cloudCover': 0.18, 'windSpeed': 8.54, 'windBearing': 275, 'summary': 'Clear', 'apparentTemperature': 52.2}, 'San Francisco': {'pressure': 1020.63, 'nearestStormDistance': 2, 'precipProbability': 0, 'humidity': 0.65, 'dewPoint': 41.43, 'icon': 'partly-cloudy-night', 'temperature': 52.83, 'precipIntensity': 0, 'visibility': 10, 'time': 1492137820, 'nearestStormBearing': 9, 'ozone': 345.56, 'cloudCover': 0.45, 'windSpeed': 10.43, 'windBearing': 304, 'summary': 'Partly Cloudy', 'apparentTemperature': 52.83}, 'San Diego': {'pressure': 1016.35, 'nearestStormDistance': 174, 'precipProbability': 0, 'humidity': 0.79, 'dewPoint': 55.09, 'icon': 'partly-cloudy-night', 'temperature': 61.75, 'precipIntensity': 0, 'visibility': 9.46, 'time': 1492137821, 'nearestStormBearing': 331, 'ozone': 304.97, 'cloudCover': 0.5, 'windSpeed': 11.78, 'windBearing': 305, 'summary': 'Partly Cloudy', 'apparentTemperature': 61.75}}\"]\n"}]}},{"text":"%pyspark\nconn = psycopg2.connect(**{'dbname': 'postgres',\n                                 'host': 'postgresql-project.cj7ztqpujxwz.us-east-1.rds.amazonaws.com',\n                                 'password': 'Kharkov62',\n                                 'user': 'ashvets'})","user":"anonymous","dateUpdated":"2017-05-09T20:17:35+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1494359260380_-647989879","id":"20170509-194740_981611730","dateCreated":"2017-05-09T19:47:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1010","dateFinished":"2017-05-09T20:17:37+0000","dateStarted":"2017-05-09T20:17:35+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\nrow = [u'SanFrancisco', 1492593603, 52.62, 0, 0, 1022.39, 0.9, 5.68, 325.74, 0.28, 49.71]\ncur = conn.cursor()\ncur.execute(\"INSERT INTO test VALUES (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s)\",\n                             (row))","user":"anonymous","dateUpdated":"2017-05-09T20:18:16+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1494359603729_-815449240","id":"20170509-195323_1359214442","dateCreated":"2017-05-09T19:53:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1182","dateFinished":"2017-05-09T20:18:16+0000","dateStarted":"2017-05-09T20:18:16+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\ncur.execute(\"rollback\")","user":"anonymous","dateUpdated":"2017-05-09T20:18:14+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1494359778446_1446549196","id":"20170509-195618_1715942960","dateCreated":"2017-05-09T19:56:18+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1256","dateFinished":"2017-05-09T20:18:14+0000","dateStarted":"2017-05-09T20:18:14+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\ncur","user":"anonymous","dateUpdated":"2017-05-09T20:18:07+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1494360457407_-1683957203","id":"20170509-200737_1144273149","dateCreated":"2017-05-09T20:07:37+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1695","dateFinished":"2017-05-09T20:18:07+0000","dateStarted":"2017-05-09T20:18:07+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"<cursor object at 0x7fd6f5951810; closed: 0>\n"}]}},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2017-05-09T20:18:03+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1494361083731_-1434399662","id":"20170509-201803_1285549652","dateCreated":"2017-05-09T20:18:03+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1982"}],"name":"psycopg2","id":"2CEZ9VKN9","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}